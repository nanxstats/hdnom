<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Introduction to hdnom • hdnom</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="An Introduction to hdnom">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hdnom</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">6.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hdnom.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nanxstats/hdnom">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>An Introduction to hdnom</h1>
                        <h4 class="author">Nan Xiao &lt;<a href="https://nanx.me" class="uri">https://nanx.me</a>&gt; <br> Miaozhu Li &lt;<a href="http://miaozhu.li" class="uri">http://miaozhu.li</a>&gt;</h4>
            
            <h4 class="date">2019-10-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nanxstats/hdnom/blob/master/vignettes/hdnom.Rmd"><code>vignettes/hdnom.Rmd</code></a></small>
      <div class="hidden name"><code>hdnom.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>It is a challenging task to model the emerging high-dimensional clinical data with survival outcomes. For its simplicity and efficiency, penalized Cox models are significantly useful for accomplishing such tasks.</p>
<p><code>hdnom</code> streamlines the workflow of high-dimensional Cox model building, nomogram plotting, model validation, calibration, and comparison.</p>
</div>
<div id="build-survival-models" class="section level1">
<h1 class="hasAnchor">
<a href="#build-survival-models" class="anchor"></a>Build Survival Models</h1>
<p>To build a penalized Cox model with good predictive performance, some parameter tuning is usually needed. For example, the elastic-net model requires to tune the <span class="math inline">\(\ell_1\)</span>-<span class="math inline">\(\ell_2\)</span> penalty trade-off parameter <span class="math inline">\(\alpha\)</span>, and the regularization parameter <span class="math inline">\(\lambda\)</span>.</p>
<p>To free the users from the tedious and error-prone parameter tuning process, <code>hdnom</code> provides several functions for automatic parameter tuning and model selection, including the following model types:</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="35%">
<col width="40%">
</colgroup>
<thead><tr class="header">
<th>Function name</th>
<th>Model type</th>
<th>Auto-tuned hyperparameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/fit_lasso.html">fit_lasso()</a></code></td>
<td>Lasso</td>
<td><span class="math inline">\(\lambda\)</span></td>
</tr>
<tr class="even">
<td><code><a href="../reference/fit_alasso.html">fit_alasso()</a></code></td>
<td>Adaptive lasso</td>
<td><span class="math inline">\(\lambda\)</span></td>
</tr>
<tr class="odd">
<td><code><a href="../reference/fit_enet.html">fit_enet()</a></code></td>
<td>Elastic-net</td>
<td>
<span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\alpha\)</span>
</td>
</tr>
<tr class="even">
<td><code><a href="../reference/fit_aenet.html">fit_aenet()</a></code></td>
<td>Adaptive elastic-net</td>
<td>
<span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\alpha\)</span>
</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/fit_mcp.html">fit_mcp()</a></code></td>
<td>MCP</td>
<td>
<span class="math inline">\(\gamma\)</span>, <span class="math inline">\(\lambda\)</span>
</td>
</tr>
<tr class="even">
<td><code><a href="../reference/fit_mnet.html">fit_mnet()</a></code></td>
<td>Mnet (MCP + <span class="math inline">\(\ell_2\)</span>)</td>
<td>
<span class="math inline">\(\gamma\)</span>, <span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\alpha\)</span>
</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/fit_scad.html">fit_scad()</a></code></td>
<td>SCAD</td>
<td>
<span class="math inline">\(\gamma\)</span>, <span class="math inline">\(\lambda\)</span>
</td>
</tr>
<tr class="even">
<td><code><a href="../reference/fit_snet.html">fit_snet()</a></code></td>
<td>Snet (SCAD + <span class="math inline">\(\ell_2\)</span>)</td>
<td>
<span class="math inline">\(\gamma\)</span>, <span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\alpha\)</span>
</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/fit_flasso.html">fit_flasso()</a></code></td>
<td>Fused lasso</td>
<td>
<span class="math inline">\(\lambda_1\)</span>, <span class="math inline">\(\lambda_2\)</span>
</td>
</tr>
</tbody>
</table>
<p>In the next, we will use the imputed SMART study data to demonstrate a complete process of model building, nomogram plotting, model validation, calibration, and comparison with <code>hdnom</code>.</p>
<p>Load the packages and the <code>smart</code> dataset:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"hdnom"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"smart"</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(smart[, <span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>)])</span>
<span id="cb2-3"><a href="#cb2-3"></a>time &lt;-<span class="st"> </span>smart<span class="op">$</span>TEVENT</span>
<span id="cb2-4"><a href="#cb2-4"></a>event &lt;-<span class="st"> </span>smart<span class="op">$</span>EVENT</span>
<span id="cb2-5"><a href="#cb2-5"></a>y &lt;-<span class="st"> </span>survival<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(time, event)</span></code></pre></div>
<p>The dataset contains 3873 observations with corresponding survival outcome (<code>time</code>, <code>event</code>). 27 clinical variables (<code>x</code>) are available as the predictors. See <code><a href="../reference/smart.html">?smart</a></code> for a detailed explanation of the variables.</p>
<p>Fit a penalized Cox model by adaptive elastic-net regularization with <code><a href="../reference/fit_aenet.html">fit_aenet()</a></code> and enable the parallel parameter tuning:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"doParallel"</span>))</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span>(<span class="kw">detectCores</span>())</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a>fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit_aenet.html">fit_aenet</a></span>(x, y, <span class="dt">nfolds =</span> <span class="dv">10</span>, <span class="dt">rule =</span> <span class="st">"lambda.1se"</span>, <span class="dt">seed =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">5</span>, <span class="dv">7</span>), <span class="dt">parallel =</span> <span class="ot">TRUE</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(fit)</span></code></pre></div>
<pre><code>## [1] "model"       "alpha"       "lambda"      "model_init"  "alpha_init" 
## [6] "lambda_init" "pen_factor"  "type"        "seed"        "call"  </code></pre>
<p>Adaptive elastic-net includes two estimation steps. The random seed used for parameter tuning, the selected best <span class="math inline">\(\alpha\)</span>, the selected best <span class="math inline">\(\lambda\)</span>, the model fitted for each estimation step, and the penalty factor for the model coefficients in the second estimation step are all stored in the model object <code>fit</code>.</p>
</div>
<div id="nomogram-visualization" class="section level1">
<h1 class="hasAnchor">
<a href="#nomogram-visualization" class="anchor"></a>Nomogram Visualization</h1>
<p>Before plotting the nomogram, we need to extract some necessary information about the model: the model object and the selected hyperparameters:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>model &lt;-<span class="st"> </span>fit<span class="op">$</span>model</span>
<span id="cb5-2"><a href="#cb5-2"></a>alpha &lt;-<span class="st"> </span>fit<span class="op">$</span>alpha</span>
<span id="cb5-3"><a href="#cb5-3"></a>lambda &lt;-<span class="st"> </span>fit<span class="op">$</span>lambda</span>
<span id="cb5-4"><a href="#cb5-4"></a>adapen &lt;-<span class="st"> </span>fit<span class="op">$</span>pen_factor</span></code></pre></div>
<p>Let’s generate a nomogram object with <code><a href="../reference/as_nomogram.html">as_nomogram()</a></code> and plot it:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>nom &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as_nomogram.html">as_nomogram</a></span>(</span>
<span id="cb6-2"><a href="#cb6-2"></a>  fit, x, time, event,</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="dt">pred.at =</span> <span class="dv">365</span> <span class="op">*</span><span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="dt">funlabel =</span> <span class="st">"2-Year Overall Survival Probability"</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>)</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(nom)</span></code></pre></div>
<p><img src="hdnom_files/figure-html/unnamed-chunk-6-1.png" width="600" height="600"></p>
<p>According to the nomogram, the adaptive elastic-net model selected 6 variables from the original set of 27 variables, effectively reduced the model complexity.</p>
<p>Information about the nomogram itself, such as the point-linear predictor unit mapping and total points-survival probability mapping, can be viewed by printing the <code>nom</code> object directly.</p>
</div>
<div id="model-validation" class="section level1">
<h1 class="hasAnchor">
<a href="#model-validation" class="anchor"></a>Model Validation</h1>
<p>It is a common practice to utilize resampling-based methods to validate the predictive performance of a penalized Cox model. Bootstrap, <span class="math inline">\(k\)</span>-fold cross-validation, and repeated <span class="math inline">\(k\)</span>-fold cross-validation are the most employed methods for such purpose.</p>
<p><code>hdnom</code> supports both internal model validation and external model validation. Internal validation takes the dataset used to build the model and evaluates the predictive performance on the data internally with the above resampling-based methods, while external validation evaluates the model’s predictive performance on a dataset which is independent to the dataset used in model building.</p>
<div id="internal-validation" class="section level2">
<h2 class="hasAnchor">
<a href="#internal-validation" class="anchor"></a>Internal Validation</h2>
<p><code><a href="../reference/validate.html">validate()</a></code> allows us to assess the model performance internally by time-dependent AUC (Area Under the ROC Curve) with the above three resampling methods.</p>
<p>Here, we validate the performance of the adaptive elastic-net model with bootstrap resampling, at every half year from the first year to the fifth year:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>val_int &lt;-<span class="st"> </span><span class="kw"><a href="../reference/validate.html">validate</a></span>(</span>
<span id="cb7-2"><a href="#cb7-2"></a>  x, time, event,</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="dt">model.type =</span> <span class="st">"aenet"</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="dt">alpha =</span> alpha, <span class="dt">lambda =</span> lambda, <span class="dt">pen.factor =</span> adapen,</span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="dt">method =</span> <span class="st">"bootstrap"</span>, <span class="dt">boot.times =</span> <span class="dv">10</span>,</span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="dt">tauc.type =</span> <span class="st">"UNO"</span>, <span class="dt">tauc.time =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="fl">0.5</span>) <span class="op">*</span><span class="st"> </span><span class="dv">365</span>,</span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="dt">seed =</span> <span class="dv">42</span>, <span class="dt">trace =</span> <span class="ot">FALSE</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>)</span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(val_int)</span></code></pre></div>
<pre><code>## High-Dimensional Cox Model Validation Object
## Random seed: 42 
## Validation method: bootstrap
## Bootstrap samples: 10 
## Model type: aenet 
## glmnet model alpha: 0.15 
## glmnet model lambda: 0.4322461 
## glmnet model penalty factor: specified
## Time-dependent AUC type: UNO 
## Evaluation time points for tAUC: 365 547.5 730 912.5 1095 1277.5 1460 1642.5 1825</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(val_int)</span></code></pre></div>
<pre><code>## Time-Dependent AUC Summary at Evaluation Time Points
##                365     547.5       730     912.5      1095    1277.5
## Mean     0.6736888 0.6980639 0.6883915 0.6877188 0.7171367 0.7329403
## Min      0.6702928 0.6943209 0.6852430 0.6838311 0.7104863 0.7274906
## 0.25 Qt. 0.6726013 0.6964793 0.6873324 0.6851874 0.7140472 0.7293532
## Median   0.6740403 0.6983876 0.6879825 0.6884841 0.7163633 0.7321747
## 0.75 Qt. 0.6749226 0.6996930 0.6896045 0.6896149 0.7210478 0.7371324
## Max      0.6760820 0.7029066 0.6916833 0.6916965 0.7236975 0.7389807
##               1460    1642.5      1825
## Mean     0.6801672 0.6841585 0.6935327
## Min      0.6713776 0.6770946 0.6800381
## 0.25 Qt. 0.6776301 0.6821142 0.6924683
## Median   0.6799323 0.6831381 0.6956346
## 0.75 Qt. 0.6825063 0.6864491 0.6966764
## Max      0.6920046 0.6939752 0.6997915</code></pre>
<p>The mean, median, 25%, and 75% quantiles of time-dependent AUC at each time point across all bootstrap predictions are listed above. The median and the mean can be considered as the bias-corrected estimation of the model performance.</p>
<p>It is also possible to plot the model validation result:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(val_int)</span></code></pre></div>
<pre><code>##                365     547.5       730     912.5      1095    1277.5
## Mean     0.6736888 0.6980639 0.6883915 0.6877188 0.7171367 0.7329403
## Min      0.6702928 0.6943209 0.6852430 0.6838311 0.7104863 0.7274906
## 0.25 Qt. 0.6726013 0.6964793 0.6873324 0.6851874 0.7140472 0.7293532
## Median   0.6740403 0.6983876 0.6879825 0.6884841 0.7163633 0.7321747
## 0.75 Qt. 0.6749226 0.6996930 0.6896045 0.6896149 0.7210478 0.7371324
## Max      0.6760820 0.7029066 0.6916833 0.6916965 0.7236975 0.7389807
##               1460    1642.5      1825
## Mean     0.6801672 0.6841585 0.6935327
## Min      0.6713776 0.6770946 0.6800381
## 0.25 Qt. 0.6776301 0.6821142 0.6924683
## Median   0.6799323 0.6831381 0.6956346
## 0.75 Qt. 0.6825063 0.6864491 0.6966764
## Max      0.6920046 0.6939752 0.6997915</code></pre>
<p><img src="hdnom_files/figure-html/unnamed-chunk-8-1.png" width="500" height="500"></p>
<p>The solid line represents the mean of the AUC, the dashed line represents the median of the AUC. The darker interval in the plot shows the 25% and 75% quantiles of AUC, the lighter interval shows the minimum and maximum of AUC.</p>
<p>It seems that the bootstrap-based validation result is stable: the median and the mean value at each evaluation time point are close; the 25% and 75% quantiles are also close to the median at each time point.</p>
<p>Bootstrap-based validation often gives relatively stable results. Many of the established nomograms in clinical oncology research are validated by bootstrap methods. <span class="math inline">\(K\)</span>-fold cross-validation provides a more strict evaluation scheme than bootstrap. Repeated cross-validation gives similar results as <span class="math inline">\(k\)</span>-fold cross-validation, and usually more robust. These two methods are more applied by the machine learning community. Check <code><a href="../reference/validate.html">?hdnom::validate</a></code> for more examples about internal model validation.</p>
</div>
<div id="external-validation" class="section level2">
<h2 class="hasAnchor">
<a href="#external-validation" class="anchor"></a>External Validation</h2>
<p>Now we have the internally validated model. To perform external validation, we usually need an independent dataset (preferably, collected in other studies), which has the same variables as the dataset used to build the model. For penalized Cox models, the external dataset should have at least the same variables that have been selected in the model.</p>
<p>For demonstration purposes, here we draw 1000 samples from the <code>smart</code> data and <em>assume</em> that they form an external validation dataset, then use <code><a href="../reference/validate_external.html">validate_external()</a></code> to perform external validation:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>x_new &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(smart[, <span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>)])[<span class="dv">1001</span><span class="op">:</span><span class="dv">2000</span>, ]</span>
<span id="cb13-2"><a href="#cb13-2"></a>time_new &lt;-<span class="st"> </span>smart<span class="op">$</span>TEVENT[<span class="dv">1001</span><span class="op">:</span><span class="dv">2000</span>]</span>
<span id="cb13-3"><a href="#cb13-3"></a>event_new &lt;-<span class="st"> </span>smart<span class="op">$</span>EVENT[<span class="dv">1001</span><span class="op">:</span><span class="dv">2000</span>]</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a>val_ext &lt;-<span class="st"> </span><span class="kw"><a href="../reference/validate_external.html">validate_external</a></span>(</span>
<span id="cb13-6"><a href="#cb13-6"></a>  fit, x, time, event,</span>
<span id="cb13-7"><a href="#cb13-7"></a>  x_new, time_new, event_new,</span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="dt">tauc.type =</span> <span class="st">"UNO"</span>,</span>
<span id="cb13-9"><a href="#cb13-9"></a>  <span class="dt">tauc.time =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.25</span>, <span class="dv">2</span>, <span class="fl">0.25</span>) <span class="op">*</span><span class="st"> </span><span class="dv">365</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>)</span>
<span id="cb13-11"><a href="#cb13-11"></a></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(val_ext)</span></code></pre></div>
<pre><code>## High-Dimensional Cox Model External Validation Object
## Model type: aenet 
## Time-dependent AUC type: UNO 
## Evaluation time points for tAUC: 91.25 182.5 273.75 365 456.25 547.5 638.75 730</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(val_ext)</span></code></pre></div>
<pre><code>## Time-Dependent AUC Summary at Evaluation Time Points
##         91.25     182.5    273.75       365    456.25     547.5   638.75
## AUC 0.4328909 0.5713055 0.6371661 0.6351403 0.6575692 0.6768453 0.683239
##           730
## AUC 0.6956754</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(val_ext)</span></code></pre></div>
<pre><code>##         91.25     182.5    273.75       365    456.25     547.5   638.75
## AUC 0.4328909 0.5713055 0.6371661 0.6351403 0.6575692 0.6768453 0.683239
##           730
## AUC 0.6956754</code></pre>
<p><img src="hdnom_files/figure-html/unnamed-chunk-9-1.png" width="500" height="500"></p>
<p>The time-dependent AUC on the external dataset is shown above.</p>
</div>
</div>
<div id="model-calibration" class="section level1">
<h1 class="hasAnchor">
<a href="#model-calibration" class="anchor"></a>Model Calibration</h1>
<p>Measuring how far the model predictions are from actual survival outcomes is known as <em>calibration</em>. Calibration can be assessed by plotting the predicted probabilities from the model versus actual survival probabilities. Similar to model validation, both internal model calibration and external model calibration are supported in <code>hdnom</code>.</p>
<div id="internal-calibration" class="section level2">
<h2 class="hasAnchor">
<a href="#internal-calibration" class="anchor"></a>Internal Calibration</h2>
<p><code><a href="../reference/calibrate.html">calibrate()</a></code> provides non-resampling and resampling methods for internal model calibration, including direct fitting, bootstrap resampling, <span class="math inline">\(k\)</span>-fold cross-validation, and repeated cross-validation.</p>
<p>For example, to calibrate the model internally with the bootstrap method:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>cal_int &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calibrate.html">calibrate</a></span>(</span>
<span id="cb19-2"><a href="#cb19-2"></a>  x, time, event,</span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="dt">model.type =</span> <span class="st">"aenet"</span>,</span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="dt">alpha =</span> alpha, <span class="dt">lambda =</span> lambda, <span class="dt">pen.factor =</span> adapen,</span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="dt">method =</span> <span class="st">"bootstrap"</span>, <span class="dt">boot.times =</span> <span class="dv">10</span>,</span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="dt">pred.at =</span> <span class="dv">365</span> <span class="op">*</span><span class="st"> </span><span class="dv">5</span>, <span class="dt">ngroup =</span> <span class="dv">3</span>,</span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="dt">seed =</span> <span class="dv">42</span>, <span class="dt">trace =</span> <span class="ot">FALSE</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>)</span>
<span id="cb19-9"><a href="#cb19-9"></a></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(cal_int)</span></code></pre></div>
<pre><code>## High-Dimensional Cox Model Calibration Object
## Random seed: 42 
## Calibration method: bootstrap
## Bootstrap samples: 10 
## Model type: aenet 
## glmnet model alpha: 0.15 
## glmnet model lambda: 0.4322461 
## glmnet model penalty factor: specified
## Calibration time point: 1825 
## Number of groups formed for calibration: 3</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(cal_int)</span></code></pre></div>
<pre><code>##   Calibration Summary Table
##   Predicted  Observed Lower 95% Upper 95%
## 1 0.7937733 0.7556172 0.7275288 0.7847901
## 2 0.8940019 0.8956157 0.8744876 0.9172544
## 3 0.9376154 0.9424155 0.9256913 0.9594419</code></pre>
<p>We split the samples into three risk groups. In practice, the number of risk groups is decided by the users according to their needs.</p>
<p>The model calibration results (the median of the predicted survival probability; the median of the observed survival probability estimated by Kaplan-Meier method with 95% CI) are summarized as above.</p>
<p>Plot the calibration result:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cal_int, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="hdnom_files/figure-html/unnamed-chunk-11-1.png" width="500" height="500"></p>
<p>In practice, you may want to perform calibration for multiple time points separately, and put the plots together in one figure. See <code><a href="../reference/calibrate.html">?hdnom::calibrate</a></code> for more examples about internal model calibration.</p>
</div>
<div id="external-calibration" class="section level2">
<h2 class="hasAnchor">
<a href="#external-calibration" class="anchor"></a>External Calibration</h2>
<p>To perform external calibration with an external dataset, use <code><a href="../reference/calibrate_external.html">calibrate_external()</a></code>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>cal_ext &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calibrate_external.html">calibrate_external</a></span>(</span>
<span id="cb24-2"><a href="#cb24-2"></a>  fit, x, time, event,</span>
<span id="cb24-3"><a href="#cb24-3"></a>  x_new, time_new, event_new,</span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="dt">pred.at =</span> <span class="dv">365</span> <span class="op">*</span><span class="st"> </span><span class="dv">5</span>, <span class="dt">ngroup =</span> <span class="dv">3</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>)</span>
<span id="cb24-6"><a href="#cb24-6"></a></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(cal_ext)</span></code></pre></div>
<pre><code>## High-Dimensional Cox Model External Calibration Object
## Model type: aenet 
## Calibration time point: 1825 
## Number of groups formed for calibration: 3</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(cal_ext)</span></code></pre></div>
<pre><code>##   External Calibration Summary Table
##   Predicted  Observed Lower 95% Upper 95%
## 1 0.7937879 0.7471369 0.6991861 0.7983762
## 2 0.8917521 0.8727998 0.8363680 0.9108185
## 3 0.9214463 0.9387588 0.9122184 0.9660715</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cal_ext, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="hdnom_files/figure-html/unnamed-chunk-12-1.png" width="500" height="500"></p>
<p>The external calibration results have the similar interpretations as the internal calibration results, except the fact that external calibration is performed on the external dataset.</p>
</div>
<div id="kaplan-meier-analysis-for-risk-groups" class="section level2">
<h2 class="hasAnchor">
<a href="#kaplan-meier-analysis-for-risk-groups" class="anchor"></a>Kaplan-Meier Analysis for Risk Groups</h2>
<p>Internal calibration and external calibration both classify the testing set into different risk groups. For internal calibration, the testing set means all the samples in the dataset that was used to build the model, for external calibration, the testing set means the samples from the external dataset.</p>
<p>We can further analyze the differences in survival time for different risk groups with Kaplan-Meier survival curves and a number at risk table. For example, here we plot the Kaplan-Meier survival curves and evaluate the number at risk from one year to six years for the three risk groups, with the function <code><a href="../reference/kmplot.html">kmplot()</a></code>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw"><a href="../reference/kmplot.html">kmplot</a></span>(</span>
<span id="cb29-2"><a href="#cb29-2"></a>  cal_int,</span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="dt">group.name =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"High risk"</span>, <span class="st">"Medium risk"</span>, <span class="st">"Low risk"</span>),</span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="dt">time.at =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span> <span class="op">*</span><span class="st"> </span><span class="dv">365</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>)</span></code></pre></div>
<p><img src="hdnom_files/figure-html/unnamed-chunk-13-1.png" width="600" height="400"></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw"><a href="../reference/kmplot.html">kmplot</a></span>(</span>
<span id="cb30-2"><a href="#cb30-2"></a>  cal_ext,</span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="dt">group.name =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"High risk"</span>, <span class="st">"Medium risk"</span>, <span class="st">"Low risk"</span>),</span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="dt">time.at =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span> <span class="op">*</span><span class="st"> </span><span class="dv">365</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>)</span></code></pre></div>
<p><img src="hdnom_files/figure-html/unnamed-chunk-13-2.png" width="600" height="400"></p>
<p>The <span class="math inline">\(p\)</span>-value of the log-rank test is also shown in the plot.</p>
</div>
<div id="log-rank-test-for-risk-groups" class="section level2">
<h2 class="hasAnchor">
<a href="#log-rank-test-for-risk-groups" class="anchor"></a>Log-Rank Test for Risk Groups</h2>
<p>To compare the differences between the survival curves, log-rank test is often applied. <code><a href="../reference/logrank_test.html">logrank_test()</a></code> performs such tests on the internal calibration and external calibration results:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>cal_int_logrank &lt;-<span class="st"> </span><span class="kw"><a href="../reference/logrank_test.html">logrank_test</a></span>(cal_int)</span>
<span id="cb31-2"><a href="#cb31-2"></a>cal_int_logrank</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = formula("Surv(time, event) ~ grp"))
## 
## n=3872, 1 observation deleted due to missingness.
## 
##          N Observed Expected (O-E)^2/E (O-E)^2/V
## grp=1 1290      291      156     117.9     178.5
## grp=2 1291      112      157      12.7      19.4
## grp=3 1291       56      147      56.1      82.7
## 
##  Chisq= 187  on 2 degrees of freedom, p= &lt;2e-16</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>cal_int_logrank<span class="op">$</span>pval</span></code></pre></div>
<pre><code>## [1] 2.532113e-41</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>cal_ext_logrank &lt;-<span class="st"> </span><span class="kw"><a href="../reference/logrank_test.html">logrank_test</a></span>(cal_ext)</span>
<span id="cb35-2"><a href="#cb35-2"></a>cal_ext_logrank</span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = formula("Surv(time, event) ~ grp"))
## 
## n=999, 1 observation deleted due to missingness.
## 
##         N Observed Expected (O-E)^2/E (O-E)^2/V
## grp=1 333       83     45.0     32.14      46.5
## grp=2 333       40     49.8      1.92       2.9
## grp=3 333       24     52.3     15.28      23.7
## 
##  Chisq= 49.5  on 2 degrees of freedom, p= 2e-11</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>cal_ext_logrank<span class="op">$</span>pval</span></code></pre></div>
<pre><code>## [1] 1.761037e-11</code></pre>
<p>The exact <span class="math inline">\(p\)</span>-values for log-rank tests are stored as <code>cal_int_logrank$pval</code> and <code>cal_ext_logrank$pval</code>. Here <span class="math inline">\(p &lt; 0.001\)</span> indicates significant differences between the survival curves for different risk groups.</p>
</div>
</div>
<div id="model-comparison" class="section level1">
<h1 class="hasAnchor">
<a href="#model-comparison" class="anchor"></a>Model Comparison</h1>
<p>Given all the available model types, it is a natural question to ask: which type of model performs the best for my data? Such questions about model type selection can be answered by built-in model comparison functions in <code>hdnom</code>.</p>
<div id="model-comparison-by-validation" class="section level2">
<h2 class="hasAnchor">
<a href="#model-comparison-by-validation" class="anchor"></a>Model Comparison by Validation</h2>
<p>We can compare the model performance using time-dependent AUC by the same (internal) model validation approach as before. For example, here we compare lasso and adaptive lasso by 5-fold cross-validation:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>cmp_val &lt;-<span class="st"> </span><span class="kw"><a href="../reference/compare_by_validate.html">compare_by_validate</a></span>(</span>
<span id="cb39-2"><a href="#cb39-2"></a>  x, time, event,</span>
<span id="cb39-3"><a href="#cb39-3"></a>  <span class="dt">model.type =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lasso"</span>, <span class="st">"alasso"</span>),</span>
<span id="cb39-4"><a href="#cb39-4"></a>  <span class="dt">method =</span> <span class="st">"cv"</span>, <span class="dt">nfolds =</span> <span class="dv">5</span>, <span class="dt">tauc.type =</span> <span class="st">"UNO"</span>,</span>
<span id="cb39-5"><a href="#cb39-5"></a>  <span class="dt">tauc.time =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.25</span>, <span class="dv">2</span>, <span class="fl">0.25</span>) <span class="op">*</span><span class="st"> </span><span class="dv">365</span>,</span>
<span id="cb39-6"><a href="#cb39-6"></a>  <span class="dt">seed =</span> <span class="dv">42</span>, <span class="dt">trace =</span> <span class="ot">FALSE</span></span>
<span id="cb39-7"><a href="#cb39-7"></a>)</span>
<span id="cb39-8"><a href="#cb39-8"></a></span>
<span id="cb39-9"><a href="#cb39-9"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(cmp_val)</span></code></pre></div>
<pre><code>## High-Dimensional Cox Model Validation Object
## Random seed: 42 
## Validation method: k-fold cross-validation
## Cross-validation folds: 5 
## Model type: lasso 
## glmnet model alpha: 1 
## glmnet model lambda: 0.01476993 
## glmnet model penalty factor: not specified
## Time-dependent AUC type: UNO 
## Evaluation time points for tAUC: 91.25 182.5 273.75 365 456.25 547.5 638.75 730
## 
## High-Dimensional Cox Model Validation Object
## Random seed: 42 
## Validation method: k-fold cross-validation
## Cross-validation folds: 5 
## Model type: alasso 
## glmnet model alpha: 1 
## glmnet model lambda: 0.07059705 
## glmnet model penalty factor: specified
## Time-dependent AUC type: UNO 
## Evaluation time points for tAUC: 91.25 182.5 273.75 365 456.25 547.5 638.75 730</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(cmp_val)</span></code></pre></div>
<pre><code>## Model type: lasso 
##              91.25     182.5    273.75       365    456.25     547.5
## Mean     0.4841358 0.6221703 0.6539481 0.6636468 0.6708724 0.6914084
## Min      0.1931153 0.5690282 0.6191897 0.6239403 0.6290850 0.6482884
## 0.25 Qt. 0.4913259 0.6058440 0.6248645 0.6515999 0.6643965 0.6743261
## Median   0.5422461 0.6165987 0.6612409 0.6714135 0.6735287 0.6905028
## 0.75 Qt. 0.5784520 0.6492297 0.6711136 0.6781820 0.6824593 0.7020803
## Max      0.6155398 0.6701508 0.6933317 0.6930982 0.7048924 0.7418443
##             638.75       730
## Mean     0.6853570 0.6779509
## Min      0.6240605 0.6219515
## 0.25 Qt. 0.6673776 0.6237589
## Median   0.7090345 0.6912658
## 0.75 Qt. 0.7093463 0.7243751
## Max      0.7169662 0.7284033
##              91.25     182.5    273.75       365    456.25     547.5
## Mean     0.4841358 0.6221703 0.6539481 0.6636468 0.6708724 0.6914084
## Min      0.1931153 0.5690282 0.6191897 0.6239403 0.6290850 0.6482884
## 0.25 Qt. 0.4913259 0.6058440 0.6248645 0.6515999 0.6643965 0.6743261
## Median   0.5422461 0.6165987 0.6612409 0.6714135 0.6735287 0.6905028
## 0.75 Qt. 0.5784520 0.6492297 0.6711136 0.6781820 0.6824593 0.7020803
## Max      0.6155398 0.6701508 0.6933317 0.6930982 0.7048924 0.7418443
##             638.75       730
## Mean     0.6853570 0.6779509
## Min      0.6240605 0.6219515
## 0.25 Qt. 0.6673776 0.6237589
## Median   0.7090345 0.6912658
## 0.75 Qt. 0.7093463 0.7243751
## Max      0.7169662 0.7284033
## 
## Model type: alasso 
##              91.25     182.5    273.75       365    456.25     547.5
## Mean     0.4906182 0.6110151 0.6447988 0.6590429 0.6699297 0.6831553
## Min      0.3226709 0.5425154 0.5886937 0.6102266 0.6355267 0.6453344
## 0.25 Qt. 0.4614064 0.5889162 0.6374044 0.6533814 0.6400765 0.6524925
## Median   0.5222798 0.6006088 0.6432538 0.6555972 0.6598076 0.6542870
## 0.75 Qt. 0.5689814 0.6363569 0.6598452 0.6699057 0.6880129 0.7048139
## Max      0.5777523 0.6866783 0.6947967 0.7061036 0.7262245 0.7588486
##             638.75       730
## Mean     0.6813285 0.6802741
## Min      0.6391167 0.6346804
## 0.25 Qt. 0.6511537 0.6380531
## Median   0.6547881 0.6705659
## 0.75 Qt. 0.7147756 0.7046057
## Max      0.7468086 0.7534652
##              91.25     182.5    273.75       365    456.25     547.5
## Mean     0.4906182 0.6110151 0.6447988 0.6590429 0.6699297 0.6831553
## Min      0.3226709 0.5425154 0.5886937 0.6102266 0.6355267 0.6453344
## 0.25 Qt. 0.4614064 0.5889162 0.6374044 0.6533814 0.6400765 0.6524925
## Median   0.5222798 0.6006088 0.6432538 0.6555972 0.6598076 0.6542870
## 0.75 Qt. 0.5689814 0.6363569 0.6598452 0.6699057 0.6880129 0.7048139
## Max      0.5777523 0.6866783 0.6947967 0.7061036 0.7262245 0.7588486
##             638.75       730
## Mean     0.6813285 0.6802741
## Min      0.6391167 0.6346804
## 0.25 Qt. 0.6511537 0.6380531
## Median   0.6547881 0.6705659
## 0.75 Qt. 0.7147756 0.7046057
## Max      0.7468086 0.7534652</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cmp_val)</span></code></pre></div>
<pre><code>##              91.25     182.5    273.75       365    456.25     547.5
## Mean     0.4841358 0.6221703 0.6539481 0.6636468 0.6708724 0.6914084
## Min      0.1931153 0.5690282 0.6191897 0.6239403 0.6290850 0.6482884
## 0.25 Qt. 0.4913259 0.6058440 0.6248645 0.6515999 0.6643965 0.6743261
## Median   0.5422461 0.6165987 0.6612409 0.6714135 0.6735287 0.6905028
## 0.75 Qt. 0.5784520 0.6492297 0.6711136 0.6781820 0.6824593 0.7020803
## Max      0.6155398 0.6701508 0.6933317 0.6930982 0.7048924 0.7418443
##             638.75       730
## Mean     0.6853570 0.6779509
## Min      0.6240605 0.6219515
## 0.25 Qt. 0.6673776 0.6237589
## Median   0.7090345 0.6912658
## 0.75 Qt. 0.7093463 0.7243751
## Max      0.7169662 0.7284033
##              91.25     182.5    273.75       365    456.25     547.5
## Mean     0.4906182 0.6110151 0.6447988 0.6590429 0.6699297 0.6831553
## Min      0.3226709 0.5425154 0.5886937 0.6102266 0.6355267 0.6453344
## 0.25 Qt. 0.4614064 0.5889162 0.6374044 0.6533814 0.6400765 0.6524925
## Median   0.5222798 0.6006088 0.6432538 0.6555972 0.6598076 0.6542870
## 0.75 Qt. 0.5689814 0.6363569 0.6598452 0.6699057 0.6880129 0.7048139
## Max      0.5777523 0.6866783 0.6947967 0.7061036 0.7262245 0.7588486
##             638.75       730
## Mean     0.6813285 0.6802741
## Min      0.6391167 0.6346804
## 0.25 Qt. 0.6511537 0.6380531
## Median   0.6547881 0.6705659
## 0.75 Qt. 0.7147756 0.7046057
## Max      0.7468086 0.7534652</code></pre>
<p><img src="hdnom_files/figure-html/unnamed-chunk-15-1.png" width="600" height="480"></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cmp_val, <span class="dt">interval =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##              91.25     182.5    273.75       365    456.25     547.5
## Mean     0.4841358 0.6221703 0.6539481 0.6636468 0.6708724 0.6914084
## Min      0.1931153 0.5690282 0.6191897 0.6239403 0.6290850 0.6482884
## 0.25 Qt. 0.4913259 0.6058440 0.6248645 0.6515999 0.6643965 0.6743261
## Median   0.5422461 0.6165987 0.6612409 0.6714135 0.6735287 0.6905028
## 0.75 Qt. 0.5784520 0.6492297 0.6711136 0.6781820 0.6824593 0.7020803
## Max      0.6155398 0.6701508 0.6933317 0.6930982 0.7048924 0.7418443
##             638.75       730
## Mean     0.6853570 0.6779509
## Min      0.6240605 0.6219515
## 0.25 Qt. 0.6673776 0.6237589
## Median   0.7090345 0.6912658
## 0.75 Qt. 0.7093463 0.7243751
## Max      0.7169662 0.7284033
##              91.25     182.5    273.75       365    456.25     547.5
## Mean     0.4906182 0.6110151 0.6447988 0.6590429 0.6699297 0.6831553
## Min      0.3226709 0.5425154 0.5886937 0.6102266 0.6355267 0.6453344
## 0.25 Qt. 0.4614064 0.5889162 0.6374044 0.6533814 0.6400765 0.6524925
## Median   0.5222798 0.6006088 0.6432538 0.6555972 0.6598076 0.6542870
## 0.75 Qt. 0.5689814 0.6363569 0.6598452 0.6699057 0.6880129 0.7048139
## Max      0.5777523 0.6866783 0.6947967 0.7061036 0.7262245 0.7588486
##             638.75       730
## Mean     0.6813285 0.6802741
## Min      0.6391167 0.6346804
## 0.25 Qt. 0.6511537 0.6380531
## Median   0.6547881 0.6705659
## 0.75 Qt. 0.7147756 0.7046057
## Max      0.7468086 0.7534652</code></pre>
<p><img src="hdnom_files/figure-html/unnamed-chunk-15-2.png" width="600" height="480"></p>
<p>The solid line, dashed line and intervals have the same interpretation as above. For this comparison, there seems to be no substantial difference (AUC difference <span class="math inline">\(&lt; 5\%\)</span>) between lasso and adaptive lasso in predictive performance, although lasso performs slightly better than adaptive lasso for the first three time points, adaptive lasso performs slightly better than lasso for the last few time points.</p>
<p>The model comparison functions in <code>hdnom</code> have a minimal input design so you do not have to set the parameters for each model type manually. The functions will try to determine the best parameter settings automatically for each model type to achieve the best performance.</p>
</div>
<div id="model-comparison-by-calibration" class="section level2">
<h2 class="hasAnchor">
<a href="#model-comparison-by-calibration" class="anchor"></a>Model Comparison by Calibration</h2>
<p>We can compare the models by comparing their (internal) model calibration performance. To continue the example, we split the samples into five risk groups, and compare lasso to adaptive lasso via calibration:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>cmp_cal &lt;-<span class="st"> </span><span class="kw"><a href="../reference/compare_by_calibrate.html">compare_by_calibrate</a></span>(</span>
<span id="cb47-2"><a href="#cb47-2"></a>  x, time, event,</span>
<span id="cb47-3"><a href="#cb47-3"></a>  <span class="dt">model.type =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lasso"</span>, <span class="st">"alasso"</span>),</span>
<span id="cb47-4"><a href="#cb47-4"></a>  <span class="dt">method =</span> <span class="st">"cv"</span>, <span class="dt">nfolds =</span> <span class="dv">5</span>,</span>
<span id="cb47-5"><a href="#cb47-5"></a>  <span class="dt">pred.at =</span> <span class="dv">365</span> <span class="op">*</span><span class="st"> </span><span class="dv">9</span>, <span class="dt">ngroup =</span> <span class="dv">5</span>,</span>
<span id="cb47-6"><a href="#cb47-6"></a>  <span class="dt">seed =</span> <span class="dv">42</span>, <span class="dt">trace =</span> <span class="ot">FALSE</span></span>
<span id="cb47-7"><a href="#cb47-7"></a>)</span>
<span id="cb47-8"><a href="#cb47-8"></a></span>
<span id="cb47-9"><a href="#cb47-9"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(cmp_cal)</span></code></pre></div>
<pre><code>## High-Dimensional Cox Model Calibration Object
## Random seed: 42 
## Calibration method: k-fold cross-validation
## Cross-validation folds: 5 
## Model type: lasso 
## glmnet model alpha: 1 
## glmnet model lambda: 0.01476993 
## glmnet model penalty factor: not specified
## Calibration time point: 3285 
## Number of groups formed for calibration: 5 
## 
## High-Dimensional Cox Model Calibration Object
## Random seed: 42 
## Calibration method: k-fold cross-validation
## Cross-validation folds: 5 
## Model type: alasso 
## glmnet model alpha: 1 
## glmnet model lambda: 0.07059705 
## glmnet model penalty factor: specified
## Calibration time point: 3285 
## Number of groups formed for calibration: 5</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(cmp_cal)</span></code></pre></div>
<pre><code>##   Model type: lasso 
##   Calibration Summary Table
##   Predicted  Observed Lower 95% Upper 95%
## 1 0.5815848 0.4825233 0.4128124 0.5640062
## 2 0.7022735 0.6976698 0.5876425 0.8282981
## 3 0.7592506 0.7918137 0.7222422 0.8680868
## 4 0.8022655 0.8610395 0.7846170 0.9449056
## 5 0.8453507 0.8857951 0.8491584 0.9240124
## 
##   Model type: alasso 
##   Calibration Summary Table
##   Predicted  Observed Lower 95% Upper 95%
## 1 0.5578115 0.4924408 0.4128066 0.5874372
## 2 0.7207998 0.7253852 0.6586664 0.7988623
## 3 0.7925433 0.8089738 0.7515262 0.8708128
## 4 0.8305489 0.8353989 0.7561476 0.9229566
## 5 0.8650625 0.9013248 0.8643684 0.9398613</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cmp_cal, <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.3</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.3</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="hdnom_files/figure-html/unnamed-chunk-16-1.png" width="600" height="480"></p>
<p>The summary output and the plot show the calibration results for each model type we want to compare. Lasso and adaptive lasso have comparable performance in this case, since their predicted overall survival probabilities are both close to the observed survival probabilities in a similar degree. Adaptive lasso seems to be slightly more stable than lasso in calibration.</p>
</div>
</div>
<div id="prediction-on-new-data" class="section level1">
<h1 class="hasAnchor">
<a href="#prediction-on-new-data" class="anchor"></a>Prediction on New Data</h1>
<p>To predict the overall survival probability on certain time points for new samples with the established models, simply use <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> on the model objects and the new data.</p>
<p>As an example, we will use the samples numbered from 101 to 105 in the <code>smart</code> dataset as the new samples, and predict their overall survival probability from one year to ten years:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(fit, x, y, <span class="dt">newx =</span> x[<span class="dv">101</span><span class="op">:</span><span class="dv">105</span>, ], <span class="dt">pred.at =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="dv">365</span>)</span></code></pre></div>
<pre><code>##            365       730      1095      1460      1825      2190      2555
## [1,] 0.9477525 0.9204206 0.8884055 0.8573295 0.8171765 0.7840601 0.7427595
## [2,] 0.9715008 0.9563035 0.9382349 0.9204068 0.8969238 0.8771525 0.8519471
## [3,] 0.9786512 0.9672021 0.9535296 0.9399734 0.9220153 0.9068029 0.8872827
## [4,] 0.8973088 0.8458249 0.7874714 0.7328425 0.6651912 0.6118826 0.5485474
## [5,] 0.9736465 0.9595694 0.9428104 0.9262503 0.9044000 0.8859696 0.8624274
##           2920      3285      3650
## [1,] 0.7043892 0.6542044 0.6542044
## [2,] 0.8279442 0.7956203 0.7956203
## [3,] 0.8685571 0.8431207 0.8431207
## [4,] 0.4928337 0.4245071 0.4245071
## [5,] 0.8399589 0.8096226 0.8096226</code></pre>
</div>
<div id="customize-color-palette" class="section level1">
<h1 class="hasAnchor">
<a href="#customize-color-palette" class="anchor"></a>Customize Color Palette</h1>
<p>The <code>hdnom</code> package has 4 unique built-in color palettes available for all above plots, inspired by the colors commonly used by scientific journals. Users can use the <code>col.pal</code> argument to select the color palette. Possible values for this argument are listed in the table below:</p>
<table class="table">
<colgroup>
<col width="18%">
<col width="69%">
</colgroup>
<thead><tr class="header">
<th>Value</th>
<th>Color palette inspiration</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"JCO"</code></td>
<td><em>Journal of Clinical Oncology</em></td>
</tr>
<tr class="even">
<td><code>"Lancet"</code></td>
<td>Lancet journals, such as <em>Lancet Oncology</em>
</td>
</tr>
<tr class="odd">
<td><code>"NPG"</code></td>
<td>NPG journals, such as <em>Nature Reviews Cancer</em>
</td>
</tr>
<tr class="even">
<td><code>"AAAS"</code></td>
<td>AAAS Journals, such as <em>Science</em>
</td>
</tr>
</tbody>
</table>
<p>By default, <code>hdnom</code> will use the JCO color palette (<code>col.pal = "JCO"</code>).</p>
</div>
<div id="shiny-app" class="section level1">
<h1 class="hasAnchor">
<a href="#shiny-app" class="anchor"></a>Shiny app</h1>
<p><a href="http://hdnom.io">http://hdnom.io</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#build-survival-models">Build Survival Models</a></li>
      <li><a href="#nomogram-visualization">Nomogram Visualization</a></li>
      <li>
<a href="#model-validation">Model Validation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#internal-validation">Internal Validation</a></li>
      <li><a href="#external-validation">External Validation</a></li>
      </ul>
</li>
      <li>
<a href="#model-calibration">Model Calibration</a><ul class="nav nav-pills nav-stacked">
<li><a href="#internal-calibration">Internal Calibration</a></li>
      <li><a href="#external-calibration">External Calibration</a></li>
      <li><a href="#kaplan-meier-analysis-for-risk-groups">Kaplan-Meier Analysis for Risk Groups</a></li>
      <li><a href="#log-rank-test-for-risk-groups">Log-Rank Test for Risk Groups</a></li>
      </ul>
</li>
      <li>
<a href="#model-comparison">Model Comparison</a><ul class="nav nav-pills nav-stacked">
<li><a href="#model-comparison-by-validation">Model Comparison by Validation</a></li>
      <li><a href="#model-comparison-by-calibration">Model Comparison by Calibration</a></li>
      </ul>
</li>
      <li><a href="#prediction-on-new-data">Prediction on New Data</a></li>
      <li><a href="#customize-color-palette">Customize Color Palette</a></li>
      <li><a href="#shiny-app">Shiny app</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nan Xiao, Qing-Song Xu, Miao-Zhu Li.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
